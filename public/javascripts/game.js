// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var socket,
      _this = this;
    console.log('loaded');
    socket = io.connect();
    socket.on("connect", function() {
      return console.log("connected");
    });
    setTimeout(function() {
      return console.info('check update');
    }, 1000);
    socket.emit('get_all_country');
    socket.emit('get_all_chat');
    $('#register-country-btn').on('click', function() {
      var player_name, register_country;
      player_name = $('#player-name').val() === "" ? "小保方晴子" : $('#player-name').val();
      register_country = $('#register-country').val();
      return socket.emit("save_player_and_country", {
        'player_name': player_name,
        'country': register_country
      });
    });
    $('#init-start').on('click', function() {
      return socket.emit('turn:init_start');
    });
    $('#start').on('click', function() {
      return socket.emit('turn:start');
    });
    $('#draw_card').on('click', function() {
      console.info("draw card");
      return socket.emit('turn:draw');
    });
    $('#sample').on('click', function() {
      return socket.emit('turn:sample');
    });
    $('#action-btn').on('click', function() {
      var action_type;
      action_type = $('#action-type').val();
      return socket.emit('turn:action', {
        'actionType': action_type
      });
    });
    $('#turn_end').on('click', function() {
      return socket.emit('turn:finish');
    });
    $('#chat-button').on('click', function() {
      var chat;
      chat = $("#chat-msg").val();
      $("#chat-msg").val("");
      return socket.emit('chat:on', {
        "msg": chat
      });
    });
    $('#game-end').on('click', function() {
      return socket.emit('game:end');
    });
    socket.on('turn:country_selected', function(data) {
      return alert("" + data.user_id + "が" + data.country + "を選びました。");
    });
    socket.on('turn:setting_msg', function(data) {
      return alert("" + data.player + "の初期設定が終わりました。");
    });
    socket.on("turn:start_msg", function(data) {
      return alert("" + data.name + "のターンです。");
    });
    socket.on('turn:draw_end', function(data) {
      console.info("draw_end");
      return alert("" + data.player + "が" + cardType + "を引きました。" + data.player + "は行動を選択して下さい");
    });
    socket.on('turn:action_selected', function(data) {
      var actionType, amount, targetCountry;
      actionType = data.action;
      targetCountry = $('#target-country').val();
      amount = $('#amount').val();
      return socket.emit("turn:" + actionType, {
        'country': targetCountry,
        'amount': amount
      });
    });
    socket.on("turn:action_buy_end", function(data) {
      var country;
      return country = data.country_name;
    });
    socket.on('all_country', function(data) {
      if ($('#countries').children().length === 0) {
        return _.map(data.countries, function(country) {
          var html;
          html = "          <br>          <div id='" + country.name + "' class='countries'>            <div class='country-name'>              国名:..." + country.name + "            </div>            <div class='market-scale'>              市場規模:..." + country.market_scale + "            </div>            <div class='market-rest'>              市場猶予:..." + country.market_rest + "            </div>            <div class='max-price'>              最高値:..." + country.max_price + "            </div>            <div class='buying_price'>              仕入れ値:..." + country.buying_price + "            </div>            <div class='owner'>              本社..." + country.player_name + "            </div>          </div>          <br>          ";
          return $('#countries').append(html);
        });
      }
    });
    socket.on('all_chat', function(data) {
      if ($('#chat-area').children().length === 0) {
        return _.map(data.chats, function(chat) {
          var html;
          html = "        <div class='chat-container'>          <div class='sender'>            " + chat.sender + " :          </div>          <div class='message'>            " + chat.message + "          </div>        </div>        ";
          return $('#chat-area').append(html);
        });
      }
    });
    socket.on('update_country_owner_name', function(data) {
      var country, player_name;
      country = data.country;
      player_name = data.name;
      return $('#' + ("" + country + " .owner")).html("本社..." + player_name);
    });
    socket.on('initial_player_status', function(data) {
      var html;
      html = "      <div class='name'>        名前:" + data.name + "      </div>      <div class='country'>        国:" + data.country + "      </div>      <div class='cash'>        キャッシュ:" + data.cash + "      </div>      <div class='income'>        純利益:" + data.income + "      </div>      <div class='number-of-product'>        製品数:" + data.product + "      </div>    ";
      return $('#player-status').append(html);
    });
    socket.on("warn:not_your_turn", function(msg) {
      return alert('おめえのターンじゃねぇから！');
    });
    socket.on("chat:send", function(data) {
      var html;
      html = "      <div class='sender'>        " + data.sender + " :      </div>      <div class='message'>        " + data.message + "      </div>    ";
      return $("#chat-area").append(html);
    });
    socket.on('game:ended', function(data) {
      return alert('game終了だ！去れ！ 別に帰れって言ってるわけじゃないんだからねっっっ//');
    });
    socket.on("warn:already_init", function(msg) {
      return alert('もう登録しとるやろ！');
    });
    socket.on("warn:already_draw", function(msg) {
      return alert('もう引いとるやろ！');
    });
    socket.on("turn:finished", function(data) {
      return alert("ターン終了。次は" + data.player_name + "のターンです");
    });
    socket.on("msg:push", function(msg) {
      var date;
      date = new Date();
      return console.info('push');
    });
    return socket.on("msg updateDB", function() {
      return console.info('msg');
    });
  });

}).call(this);
